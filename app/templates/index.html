{% import 'partials/section.html' as section %}
{% extends "layouts/_twocol.html" %}

{% block content %}

<head>
    <meta charset="UTF-8">
    <title>SDX Tester</title>
</head>
<body>
    <div>
        <form action="/submit" method="post">
            <select name="surveys names" id="survey_names"  style="width:300px; border:2px solid #000;
            border-radius: 5px;">
                <li>surveys</li>
                {% for x in surveys %}
                    <option value= "{{ x }}">{{ x['survey_id'] }}.{{ x['collection']['instrument_id'] }}</option>
                {% endfor %}
            </select>
            <br>
            <br>
            <textarea id="post-data" name="post-data" rows="33" cols="50" style="border:2px solid #000;
            border-radius: 5px;">

            </textarea>
            <ul style="float:right; display:inline-block; border:2px solid #000; padding:20px; list-style: none;
            border-radius: 5px;" id="test">
                {% for time, tx_id in tx_list.items() %}
                <li> {{ time }}:  <a href = "{{url_for('view_response', tx_id=tx_id )}}"> {{ tx_id }} </a></li>
                {% endfor %}
            </ul>
            <br>
            <button type="button" onclick="prettyPrint()">Pretty Print</button>
            <input id="submit" type="submit" value="Submit" style="margin-top: 20px">

            <script>
                document.getElementById("survey_names").addEventListener('change', function(event) {
                    document.getElementById("post-data").value = event.target.value
                });
            </script>
            <script>
                function prettyPrint() {
                    var ugly = document.getElementById('post-data').value;
                    var replaceFalse = ugly.replace(/False/g, 'false');
                    var replaceTrue = replaceFalse.replace(/True/g, 'true');
                    var replaceSingleLeft = replaceTrue.replace(/'/, '"');
                    var obj = JSON.parse(replaceSingleLeft);
                    var pretty = JSON.stringify(obj, undefined, 4);
                    document.getElementById('post-data').value = pretty;
                }
            </script>
        </form>
    </div>
</body>

{% endblock content %}